<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.workOrder.itemStockMove">
	<select id="get_itemStockMove_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT A.ITEM_ID
		     , B.ITEM_NAME
		     , B.SPECIFICATION
		     , ROUND(A.CURRENT_QTY, 4) CURRENT_QTY
		     , A.PREV_QTY
		     , B.UNIT
		     , A.LOCATION_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_FACILITY_NAME (A.DIVISION_CD, A.COMPANY_CD, A.LOCATION_CD) FROM DUAL) AS LOCATION_OUT_NAME
		     , (SELECT MOM_COMMON_PKG.FN_GET_FACILITY_NAME (B.DIVISION_CD, B.COMPANY_CD, B.OUT_LOCATION_ID) FROM DUAL) AS LOCATION_IN_NAME
		     , A.ITEM_STOCK_ID
		     , B.ITEM_TYPE
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME ( B.DIVISION_CD
		                                               , B.COMPANY_CD
		                                               , 'ITEM_TYPE'
		                                               , B.ITEM_TYPE)
		          FROM DUAL) AS ITEM_TYPE_NAME
		     , NVL(B.FREE_OFFER_FLAG, 'N')  AS FREE_OFFER_FLAG
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(A.DIVISION_CD, A.COMPANY_CD, 'FREE_OFFER', NVL(B.FREE_OFFER_FLAG, 'N')) 
		        FROM   DUAL ) AS FREE_OFFER_NAME
		     , A.DESCRIPTION
		  FROM MOM_ITEM_STOCK A
		     , MOM_ITEM_DEFINITION B
		 WHERE A.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND A.DIVISION_CD = B.DIVISION_CD(+)
		   AND A.COMPANY_CD = B.COMPANY_CD(+)
		   AND A.ITEM_ID = B.ITEM_ID(+)
		   AND A.LOCATION_CD IN (SELECT FACILITY_CD FROM MOM_FACILITY 
		                          WHERE DIVISION_CD = A.DIVISION_CD 
		                            AND COMPANY_CD = A.COMPANY_CD 
		                            AND FACILITY_TYPE IN ('FAC300','FAC500')) 
		  <if test="locationName != null and locationName != ''">
		   AND A.LOCATION_CD = #{locationName, jdbcType=VARCHAR}
		  </if>
		  <if test="itemType != null and itemType != ''">
		   AND B.ITEM_TYPE = #{itemType, jdbcType=VARCHAR}
		  </if>
		  <if test="itemName != null and itemName != ''">
		   AND A.ITEM_ID = #{itemName, jdbcType=VARCHAR}
		  </if>
		  <if test="zeroFlag != null and zeroFlag != ''">
			<choose>
				<when test='zeroFlag.equals("N")'>
					AND A.CURRENT_QTY != 0
				</when>
				<when test='zeroFlag != "Y" and zeroFlag != "N"'>
				<![CDATA[AND A.CURRENT_QTY < 0]]>
				</when>
			</choose>
		  </if>
		  ORDER BY A.ITEM_ID, A.LOCATION_CD
	</select>
	
</mapper>