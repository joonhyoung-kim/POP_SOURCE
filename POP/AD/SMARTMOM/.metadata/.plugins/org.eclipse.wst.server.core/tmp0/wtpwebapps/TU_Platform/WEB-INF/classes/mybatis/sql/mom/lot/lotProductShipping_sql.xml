<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.lot.lotProductShipping">
	<select id="get_lotProductShipping_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT A.RESOURCE_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_RESOURCE_NAME (A.DIVISION_CD, A.COMPANY_CD, A.RESOURCE_CD) FROM DUAL) AS RESOURCE_NAME
		     , A.DESTINATION_CD
		     , A.DESTINATION_NAME
		     , A.CUSTOMER_CODE
		     , A.VENDOR_NAME
		     , A.ITEM_GROUP_SMALL
		     , A.CAR_NAME
		     , A.ITEM_ID
		     , A.ITEM_NAME
		     , A.IO_TIME
		     , A.QTY
		     , A.CNT
		     , A.BARCODE_ID
		  FROM  (SELECT B.DESTINATION_CD
		              , B.DESTINATION_NAME
		              , B.VENDOR_CD       AS CUSTOMER_CODE
		              , B.VENDOR_NAME
		              , D.ITEM_GROUP_SMALL
		              , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME (D.DIVISION_CD, D.COMPANY_CD, 'MATERIAL_GROUP_SMALL', D.ITEM_GROUP_SMALL)
		                 FROM     DUAL) AS CAR_NAME
		              , A.ITEM_ID
		              , D.ITEM_NAME
		              , TO_CHAR(I.IO_TIME, 'yyyy-mm-dd') AS IO_TIME
		              , A.QTY
		              , (SELECT COUNT (*)
		                 FROM   MOM_ITEM_LABEL_REL LR
		                 WHERE  LR.DIVISION_CD = A.DIVISION_CD
		                 AND    LR.OUT_BARCODE_ID = A.BARCODE_ID
		                 AND    LR.DIVISION_CD = 'Y') AS CNT
		              , A.BARCODE_ID
		              , A.DIVISION_CD
		              , A.COMPANY_CD
		              , (SELECT  RESOURCE_CD
		                 FROM    MOM_WORK_ORDER
		                 WHERE   DIVISION_CD   = A.DIVISION_CD
		                 AND     COMPANY_CD    = A.COMPANY_CD
		                 AND     WORK_ORDER_ID = (SELECT  MIN(ITEM_ORDER_ID)
		                                          FROM    MOM_ITEM_LABEL
		                                          WHERE   DIVISION_CD = A.DIVISION_CD
		                                          AND     COMPANY_CD = A.COMPANY_CD
		                                          AND     BARCODE_ID IN (SELECT IN_BARCODE_ID
		                                                                 FROM   MOM_ITEM_LABEL_REL
		                                                                 WHERE  DIVISION_CD = A.DIVISION_CD
		                                                                 AND    COMPANY_CD = A.COMPANY_CD
		                                                                 AND    OUT_BARCODE_ID = A.BARCODE_ID) )) AS RESOURCE_CD
		         FROM   MOM_ITEM_LABEL A
		              , MOM_ITEM_STOCK_INOUT I
		              , MOM_SALES_ORDER_V B
		              , MOM_ITEM_DEFINITION D
		         WHERE  A.DIVISION_CD   = I.DIVISION_CD
		         AND    A.COMPANY_CD    = I.COMPANY_CD
		         AND    A.ITEM_ORDER_ID = I.ITEM_STOCK_INOUT_ID
		         AND    I.DIVISION_CD   = B.DIVISION_CD
		         AND    I.COMPANY_CD    = B.COMPANY_CD
		         AND    I.ITEM_ORDER_ID = B.SALES_ORDER_ID
		         AND    A.DIVISION_CD   = D.DIVISION_CD
		         AND    A.COMPANY_CD    = D.COMPANY_CD
		         AND    A.ITEM_ID       = D.ITEM_ID
		         AND    A.DIVISION_CD   = #{divisionCd, jdbcType=VARCHAR}
		         AND    A.COMPANY_CD    = #{companyCd, jdbcType=VARCHAR}
		         AND    A.BARCODE_TYPE  = 'SHIP'
		         AND    TO_DATE(I.IO_TIME, 'YYYY-MM-DD') BETWEEN TO_DATE (#{fromDate, jdbcType=VARCHAR}, 'YYYY-MM-DD') AND TO_DATE (#{toDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		        <if test="inItem != null and inItem != ''">
		         AND (D.ITEM_ID LIKE UPPER('%' || #{inItem, jdbcType=VARCHAR} || '%') 
		          OR UPPER(D.ITEM_NAME) LIKE UPPER('%' || #{inItem, jdbcType=VARCHAR} || '%'))
		        </if>
		        <if test="inVendor != null and inVendor != ''">
		         AND B.VENDOR_CD = #{inVendor, jdbcType=VARCHAR}
		        </if>
		        <if test="inDestination != null and inDestination != ''">
		         AND B.DESTINATION_CD = #{inDestination, jdbcType=VARCHAR}
		        </if>
		       ) A
		  WHERE 1=1
		   <if test="inResource != null and inResource != ''">
		    AND A.RESOURCE_CD = #{inResource, jdbcType=VARCHAR}
		   </if>
		  ORDER BY DESTINATION_CD
	</select>
	
	<select id="get_lotProductShippingDetail_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT WO.RESOURCE_CD
	         , (SELECT MOM_COMMON_PKG.FN_GET_RESOURCE_NAME (WO.DIVISION_CD, WO.COMPANY_CD, WO.RESOURCE_CD) FROM DUAL) AS RESOURCE_NAME
	         , WO.ITEM_ID
	         , (SELECT MOM_COMMON_PKG.FN_GET_ITEM_NAME (WO.DIVISION_CD, WO.COMPANY_CD, WO.ITEM_ID) FROM DUAL) AS ITEM_NAME
	         , L.BARCODE_ID
	         , WOR.START_TIME
	         , L.QTY
	      FROM MOM_ITEM_LABEL_REL R
	      	 , MOM_ITEM_LABEL L
	         , MOM_WORK_ORDER_RESULT WOR
	         , MOM_WORK_ORDER WO
	   	 WHERE  R.DIVISION_CD           = L.DIVISION_CD
	   	   AND  R.COMPANY_CD            = L.COMPANY_CD
		   AND  R.IN_BARCODE_ID         = L.BARCODE_ID
		   AND  L.DIVISION_CD           = WOR.DIVISION_CD
		   AND  L.COMPANY_CD            = WOR.COMPANY_CD
		   AND  L.WORK_ORDER_RESULT_ID  = WOR.WORK_ORDER_RESULT_ID
		   AND  WOR.DIVISION_CD         = WO.DIVISION_CD
		   AND  WOR.COMPANY_CD          = WO.COMPANY_CD
		   AND  WOR.WORK_ORDER_ID       = WO.WORK_ORDER_ID
		   AND  R.DIVISION_CD           = #{divisionCd, jdbcType=VARCHAR}
		   AND  R.COMPANY_CD            = #{companyCd, jdbcType=VARCHAR}
		   AND  R.OUT_BARCODE_ID        = #{barcodeId, jdbcType=VARCHAR}
		   AND  R.USE_YN                = 'Y'
    </select>
	
</mapper>