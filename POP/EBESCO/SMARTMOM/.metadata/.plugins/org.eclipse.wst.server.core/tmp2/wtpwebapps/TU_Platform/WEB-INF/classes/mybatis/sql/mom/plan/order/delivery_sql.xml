<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.plan.order.delivery">
	<select id="get_delivery_list" resultType="camelMap" parameterType="java.util.HashMap">
	WITH TEMP1 AS (
		SELECT SEND_SEQ
		     , INTERFACE_ID
		     , JOB_CODE
		     , WORK_DATE
		     , TRANSACTION_ID
		     , ORGANIZATION_ID
		     , ORGANIZATION_CODE
		     , VENDOR_SITE_ID
		     , VENDOR_SITE_CODE
		     , VENDOR_NAME
		     , REQUEST_DATE
		     , INVENTORY_ITEM_ID
		     , PART_NO
		     , ITEM_DESC
		     , UIT
		     , ITEM_SPEC
		     , WIP_ENTITY_ID
		     , WIP_ENTITY_NAME
		     , STATUS_TYPE
		     , DELIVERY_STATUS
		     , WIP_LINE_ID
		     , WIP_LINE_CODE
		     , DEMAND_SUBINVENTORY_CODE
		     , DEMAND_SUBINV_DESC
		     , MARKET_CODE
		     , CURRENCY_CODE
		     , PO_NO
		     , DELIVERY_REQUEST_QTY
		     , SUPPLY_DEPARTURE_QTY
		     , RECEIPT_QTY
		     , DEMAND_REMAINED_QTY
		     , TO_CHAR(LAST_UPDATE_DATE, 'yyyy-mm-dd hh24:mi:ss') AS LAST_UPDATE_DATE
		     , ASSY_PART_NO
		     , DELIVERY_TYPE_CODE
		     , VMI_FLAG
		     , TO_CHAR(SCHEDULED_START_DATE, 'yyyy-mm-dd hh24:mi:ss') AS SCHEDULED_START_DATE
		     , HW_VERSION
		     , RECEIVER
		     , TO_CHAR(CREATION_DATE, 'yyyy-mm-dd hh24:mi:ss') AS CREATION_DATE
		     , CREATED_BY
		     , IF_ATTRIBUTE1
		     , IF_ATTRIBUTE2
		     , IF_ATTRIBUTE3
		     , IF_ATTRIBUTE4
		     , IF_ATTRIBUTE5
		     , IF_ATTRIBUTE6
		     , IF_ATTRIBUTE7
		     , IF_ATTRIBUTE8
		     , IF_ATTRIBUTE9
		     , IF_ATTRIBUTE10
		     , IF_ATTRIBUTE11
		     , IF_ATTRIBUTE12
		     , IF_ATTRIBUTE13
		     , IF_ATTRIBUTE14
		     , IF_ATTRIBUTE15
		     , IF_ATTRIBUTE16
		     , IF_ATTRIBUTE17
		     , IF_ATTRIBUTE18
		     , IF_ATTRIBUTE19
		     , IF_ATTRIBUTE20
		     , TRANSFER_FLAG
		     , TO_CHAR(TRANSFER_DATE, 'yyyy-mm-dd hh24:mi:ss') AS TRANSFER_DATE
		     , STEP_CODE
		     , STEP_STATUS_CODE
		  FROM TU_EAI.IF_LGE_SUP_DELIVERY_ORDER 
		  WHERE 1 = 1
		  <if test = "fromDate != null and fromDate != '' and toDate != null and toDate != ''">
		  AND  SUBSTR(REQUEST_DATE, 0, 8) BETWEEN TO_CHAR(REPLACE(#{fromDate, jdbcType=VARCHAR}, '-')) AND TO_CHAR(REPLACE(#{toDate, jdbcType=VARCHAR}, '-'))
		  </if>
		  <if test = "orgCode != null and orgCode != ''">
		  AND ORGANIZATION_CODE = #{orgCode, jdbcType=VARCHAR}
		  </if>
		  <if test = "itemId != null and itemId != ''">
		  AND (PART_NO LIKE '%' || TRIM(UPPER(#{itemId, jdbcType=VARCHAR})) || '%'
		      OR UPPER(ITEM_DESC) LIKE '%' || TRIM(UPPER(#{itemId, jdbcType=VARCHAR})) || '%') <!-- XMOMG59 / pyj / 검색조건 품명 추가 및 UPPER처리 -->
		  </if>
		  <if test = "workOrder != null and workOrder != ''">
		  AND UPPER(WIP_ENTITY_NAME)  LIKE '%' || TRIM(UPPER(#{workOrder, jdbcType=VARCHAR})) || '%' <!-- XMOMG60 / pyj / 검색조건 Work Order UPPER처리 -->
		  </if>
		  <if test = "customerPoId != null and customerPoId != ''">
		  AND UPPER(PO_NO) LIKE '%' || TRIM(UPPER(#{customerPoId, jdbcType=VARCHAR})) || '%'
		  </if>
		  AND VENDOR_SITE_CODE = (SELECT P.B2BI_VENDOR_CD 
	                                   FROM   MOM_PARAMETER P
	                                   WHERE  P.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR})
	      ORDER BY REQUEST_DATE DESC
	  )
	 SELECT A.*
           , B.ROW_COUNT
      FROM (SELECT A.*
                 , ROWNUM GRIDROW
              FROM TEMP1 A) A
         , (SELECT COUNT(*) ROW_COUNT
              FROM TEMP1) B 
		<if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
	  WHERE GRIDROW BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
	    </if>
	</select>
	
<!-- 	<select id="get_deliveryCount_list" resultType="camelMap" parameterType="java.util.HashMap"> -->
<!-- 		 SELECT count(*) AS ROW_COUNT -->
<!--           FROM TU_EAI.IF_LGE_SUP_DELIVERY_ORDER  -->
<!--          WHERE 1=1 -->
<!--          <if test = "fromDate != null and fromDate != '' and toDate != null and toDate != ''"> -->
<!-- 		 AND  SUBSTR(REQUEST_DATE, 0, 8) BETWEEN TO_CHAR(REPLACE(#{fromDate, jdbcType=VARCHAR}, '-')) AND TO_CHAR(REPLACE(#{fromDate, jdbcType=VARCHAR}, '-')) -->
<!-- 		 </if> -->
<!-- 		 <if test = "orgCode != null and orgCode != ''"> -->
<!-- 		 AND ORGANIZATION_CODE = #{orgCode, jdbcType=VARCHAR} -->
<!-- 		 </if> -->
<!-- 		 <if test = "itemId != null and itemId != ''"> -->
<!-- 		 AND PART_NO = #{itemId, jdbcType=VARCHAR} -->
<!-- 		 </if> -->
<!-- 		 <if test = "workOrder != null and workOrder != ''"> -->
<!-- 		 AND WIP_ENTITY_NAME = #{workOrder, jdbcType=VARCHAR} -->
<!-- 		 </if> -->
<!-- 		 <if test = "customerPoId != null and customerPoId != ''"> -->
<!-- 		 AND PO_NO LIKE '%' ||#{customerPoId, jdbcType=VARCHAR} || '%' -->
<!-- 	     </if> -->
<!-- 	     AND VENDOR_SITE_CODE = (SELECT P.B2BI_VENDOR_CD  -->
<!--                                    FROM   MOM_PARAMETER P -->
<!--                                    WHERE  P.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}) -->
<!-- 	</select> -->


</mapper>