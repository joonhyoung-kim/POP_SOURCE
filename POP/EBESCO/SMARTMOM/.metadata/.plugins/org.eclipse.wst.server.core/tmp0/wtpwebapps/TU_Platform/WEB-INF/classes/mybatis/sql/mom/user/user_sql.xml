<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.user">
	
	<!-- modify_hists 
    * XMOMA11 / 20191106 / gyp / TRIM, UPPER 처리
     -->
	<select id="get_user_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT DIVISION_CD         
		     , COMPANY_CD         
		     , USER_ID AS USER_ID_TMP         
		     , PASSWORD            
		     , EMP_NO              
		     , NAME                
		     , NAME_ENG            
		     , POSITION
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'POSITION', POSITION) FROM DUAL) AS POSITION_NAME            
		     , EMAIL              
		     , CELL_PHONE_NO       
		     , OFFICE_PHONE_NO     
		     , FAX_NO              
		     , USER_TYPE           
		     , MANAGER_YN
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'N_Y', MANAGER_YN) FROM DUAL) AS MANAGER_YN_NAME          
		     , DEFAULT_LANGUAGE 
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'LANGUAGE_CODE', DEFAULT_LANGUAGE) FROM DUAL) AS DEFAULT_LANGUAGE_NAME    
		     , DEPT_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'DEPT_CD', DEPT_CD) FROM DUAL) AS DEPT_NAME             
		     , EMP_AUTHORITY
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'EMP_AUTHORITY', EMP_AUTHORITY) FROM DUAL) AS EMP_AUTHORITY_NAME       
		     , USE_YN    
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(DIVISION_CD, COMPANY_CD, 'USE_FLAG', USE_YN) FROM DUAL) AS USE_YN_NAME          
		     , DESCRIPTION         
		     , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE       
		     , CREATE_BY          
		     , TO_CHAR(UPDATE_DATE, 'YYYY-MM-DD') AS UPDATE_DATE        
		     , UPDATE_BY                   
		     , LOCK_STATUS         
		     , PWERR_CN            
		     , NVL(TO_CHAR(PWCHG_DT, 'YYYY-MM-DD'), '0000-00-00') AS PWCHG_DT           
		     , NVL(TO_CHAR(LAST_LOGON_DT, 'YYYY-MM-DD HH24:MI:SS'), '0000-00-00 00:00:00') AS LAST_LOGON_DT
		     , VENDOR_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_VENDOR_NAME(DIVISION_CD, COMPANY_CD, VENDOR_CD) FROM DUAL) AS VENDOR_NAME
		FROM TU_USER
	   <where>
		AND DIVISION_CD =  #{divisionCd, jdbcType=VARCHAR}         
	    AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} 
	    <if test = "empNo != null and empNo != ''">
	    AND UPPER(EMP_NO) LIKE '%' || TRIM(UPPER(#{empNo, jdbcType=VARCHAR})) || '%'
	    </if>   
	    <if test = "empName != null and empName != ''">
	    AND UPPER(NAME) LIKE '%' || TRIM(UPPER(#{empName, jdbcType=VARCHAR})) || '%'
	    </if> 
	    <if test = "partName != null and partName != ''">
	    AND DEPT_CD = #{partName, jdbcType=VARCHAR} 
	    </if> 
	    <if test = 'empAuthority != "99999999" '>
        AND EMP_AUTHORITY != '99999999' 
        </if>  
	   </where> 
	    ORDER BY DIVISION_CD, COMPANY_CD, NAME ASC 
	</select>
	
	<select id="get_user" resultType="hashmap" parameterType="java.util.HashMap">
        SELECT A.DIVISION_CD
             , B.DIVISION_NAME
             , A.COMPANY_CD
             , B.COMPANY_NAME
             , A.USER_ID
             , A.PASSWORD            
             , A.EMP_NO              
             , A.NAME                
             , A.NAME_ENG            
             , A.POSITION           
             , A.EMAIL              
             , A.CELL_PHONE_NO       
             , A.OFFICE_PHONE_NO     
             , A.FAX_NO              
             , A.USER_TYPE           
             , A.MANAGER_YN          
             , A.DEFAULT_LANGUAGE    
             , A.DEPT_CD
             , NVL((SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(A.DIVISION_CD, A.COMPANY_CD, 'DEPT_CD', A.DEPT_CD) FROM DUAL), '-') AS DEPT_NAME
             , A.EMP_AUTHORITY       
             , A.USE_YN              
             , A.DESCRIPTION         
             , TO_CHAR(A.CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE       
             , A.CREATE_BY          
             , TO_CHAR(A.UPDATE_DATE, 'YYYY-MM-DD') AS UPDATE_DATE        
             , A.UPDATE_BY                   
             , A.LOCK_STATUS         
             , A.PWERR_CN            
             , NVL(TO_CHAR(A.PWCHG_DT, 'YYYY-MM-DD'), '0000-00-00') AS PWCHG_DT           
             , NVL(TO_CHAR(A.LAST_LOGON_DT, 'YYYY-MM-DD HH24:MI:SS'), '0000-00-00 00:00:00') AS LAST_LOGON_DT
             , A.VENDOR_CD
             , P.STANDARD_TIME
        FROM TU_USER A
           , MOM_SITE B
           , MOM_PARAMETER P
	   WHERE A.DIVISION_CD =  #{divisionCd, jdbcType=VARCHAR}         
	     AND A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}         
	     AND A.USER_ID = #{userId, jdbcType=VARCHAR} 
         AND A.DIVISION_CD = B.DIVISION_CD
         AND A.COMPANY_CD = B.COMPANY_CD
         AND A.DIVISION_CD = P.DIVISION_CD
         AND A.COMPANY_CD = P.COMPANY_CD
	</select>
	
	<insert id="create_user" parameterType="java.util.HashMap">
		INSERT INTO TU_USER(
		      DIVISION_CD         
		    , COMPANY_CD         
		    , USER_ID             
		    , PASSWORD            
		    , EMP_NO              
		    , NAME                
		    , NAME_ENG            
		    , POSITION           
		    , EMAIL              
		    , CELL_PHONE_NO       
		    , OFFICE_PHONE_NO     
		    , FAX_NO              
		    , USER_TYPE           
		    , MANAGER_YN          
		    , DEFAULT_LANGUAGE    
		    , DEPT_CD             
		    , EMP_AUTHORITY       
		    , USE_YN              
		    , DESCRIPTION         
		    , CREATE_DATE        
		    , CREATE_BY          
		    , UPDATE_DATE
		    , UPDATE_BY                 
		    , LOCK_STATUS         
		    , PWERR_CN            
		    , PWCHG_DT
		    , LAST_LOGON_DT
		    , VENDOR_CD
		)
		VALUES(
		      #{divisionCd, jdbcType=VARCHAR}         
		    , #{companyCd, jdbcType=VARCHAR}         
		    , #{userIdTmp, jdbcType=VARCHAR}             
		    , #{password, jdbcType=VARCHAR}            
		    , #{empNo, jdbcType=VARCHAR}              
		    , #{name, jdbcType=VARCHAR}                
		    , #{nameEng, jdbcType=VARCHAR}            
		    , #{position, jdbcType=VARCHAR}           
		    , #{email, jdbcType=VARCHAR}              
		    , #{cellPhoneNo, jdbcType=VARCHAR}       
		    , #{officePhoneNo, jdbcType=VARCHAR}     
		    , #{faxNo, jdbcType=VARCHAR}              
		    , #{userType, jdbcType=VARCHAR}           
		    , #{managerYn, jdbcType=VARCHAR}          
		    , #{defaultLanguage, jdbcType=VARCHAR}    
		    , #{deptCd, jdbcType=VARCHAR}             
		    , #{empAuthority, jdbcType=VARCHAR}       
		    , NVL(TRIM(UPPER(#{useYn, jdbcType=VARCHAR})), 'Y')              
		    , #{description, jdbcType=VARCHAR}         
		    , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})        
		    , #{createBy, jdbcType=VARCHAR}          
		    , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		    , #{updateBy, jdbcType=VARCHAR}                 
		    , #{lockStatus, jdbcType=VARCHAR}         
		    , #{pwerrCn, jdbcType=INTEGER}           
		    , TO_DATE(#{pwchgDt, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		    , TO_DATE(#{lastLogonDt, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		    , TRIM(UPPER(#{vendorCd, jdbcType=VARCHAR}))
		)
	</insert>
	
	<update id="modify_user" parameterType="java.util.HashMap">
		UPDATE TU_USER
		SET PASSWORD = #{password, jdbcType=VARCHAR}             
		  , EMP_NO = #{empNo, jdbcType=VARCHAR}           
		  , NAME = #{name, jdbcType=VARCHAR}               
		  , NAME_ENG = #{nameEng, jdbcType=VARCHAR}           
		  , POSITION = #{position, jdbcType=VARCHAR}          
		  , EMAIL = #{email, jdbcType=VARCHAR}             
		  , CELL_PHONE_NO = #{cellPhoneNo, jdbcType=VARCHAR}      
		  , OFFICE_PHONE_NO = #{officePhoneNo, jdbcType=VARCHAR}    
		  , FAX_NO = #{faxNo, jdbcType=VARCHAR}             
		  , USER_TYPE = #{userType, jdbcType=VARCHAR}          
		  , MANAGER_YN = #{managerYn, jdbcType=VARCHAR}         
		  , DEFAULT_LANGUAGE = #{defaultLanguage, jdbcType=VARCHAR}   
		  , DEPT_CD = #{deptCd, jdbcType=VARCHAR}            
		  , EMP_AUTHORITY = #{empAuthority, jdbcType=VARCHAR}      
		  , USE_YN = NVL(TRIM(UPPER(#{useYn, jdbcType=VARCHAR})), 'Y')
		  , DESCRIPTION = #{description, jdbcType=VARCHAR}        
		  , UPDATE_DATE = MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		  , UPDATE_BY = #{updateBy, jdbcType=VARCHAR}      
		  , PWCHG_DT = MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		  , VENDOR_CD = TRIM(UPPER(#{vendorCd, jdbcType=VARCHAR}))
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND USER_ID = #{userIdTmp, jdbcType=VARCHAR}
	</update>
	
	<update id="modify_user_password" parameterType="java.util.HashMap">
		UPDATE TU_USER
			SET PASSWORD = #{newPassword, jdbcType=VARCHAR}
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND USER_ID = #{userId, jdbcType=VARCHAR}
		AND PASSWORD = #{nowPassword, jdbcType=VARCHAR}
	</update>
	
	<delete id="remove_user" parameterType="java.util.HashMap">
		DELETE FROM TU_USER
		WHERE  DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
	    AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND USER_ID = #{userIdTmp, jdbcType=VARCHAR}
	</delete>
	
	<select id="get_chkUser_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT *
		  FROM TU_USER
		 WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND USER_ID = #{chkUserId, jdbcType=VARCHAR}
	</select>

</mapper>