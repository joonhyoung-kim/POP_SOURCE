<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.equipment.equipmentWoCreate">
	<select id="get_equipmentWoCreate_list" resultType="camelMap" parameterType="java.util.HashMap">
		<if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
		WITH TEMP1 AS (	
	    </if>
		SELECT A.EQM_TYPE
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME (A.DIVISION_CD
		     										  , A.COMPANY_CD
		     										  , 'EQ_WO_TYPE'
		     										  , A.EQM_TYPE)
		          FROM DUAL) AS EQM_TYPE_NAME
		     , A.EQM_WO_ID
		     , A.EQM_WO_NAME
		     , A.EQUIPMENT_CD
		     , A.EQUIPMENT_NAME
		     , A.RESOURCE_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_RESOURCE_NAME (A.DIVISION_CD
		     											  , A.COMPANY_CD
		     											  , A.RESOURCE_CD)
		          FROM DUAL) AS RESOURCE_NAME
		     , A.EQM_QTY
		     , TO_CHAR(A.PLAN_START_DATE, 'YYYY-MM-DD') AS PLAN_START_DATE
		     , TO_CHAR(A.PLAN_END_DATE, 'YYYY-MM-DD') AS PLAN_END_DATE
		     , TO_CHAR(A.CANCEL_DATE, 'YYYY-MM-DD') AS CANCEL_DATE
		     , A.STATUS
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME (A.DIVISION_CD
		     										  , A.COMPANY_CD
		     										  , 'EQM_ORDER_REQ_STATUS'
		     										  , A.STATUS)
		          FROM DUAL) AS STATUS_NAME
		     , A.PRIORITY
		     , A.REASON_CODE
		     , A.DESCRIPTION
		     , TO_CHAR(A.CREATE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS CREATE_DATE
             , A.CREATE_BY
             , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME( A.DIVISION_CD
	                                                  , A.COMPANY_CD  
	                                                  , A.CREATE_BY)
	              FROM DUAL) AS CREATE_BY_NAME
             , TO_CHAR(A.UPDATE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS UPDATE_DATE
             , A.UPDATE_BY
             , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME( A.DIVISION_CD
	                                                  , A.COMPANY_CD  
	                                                  , A.UPDATE_BY)
	              FROM DUAL) AS UPDATE_BY_NAME 
		 FROM (SELECT A.DIVISION_CD
		            , A.COMPANY_CD
		            , A.EQM_TYPE
		            , A.EQM_WO_ID
		            , A.EQM_WO_NAME
		            , A.EQUIPMENT_CD
		            , (SELECT MOM_COMMON_PKG.FN_GET_EQUIPMENT_NAME( A.DIVISION_CD, A.COMPANY_CD, A.EQUIPMENT_CD)
		                 FROM DUAL) AS EQUIPMENT_NAME
		            , ME.RESOURCE_CD
		            , A.EQM_QTY
		            , A.PLAN_START_DATE
		            , A.PLAN_END_DATE
		            , A.CANCEL_DATE
		            , A.STATUS
		            , A.PRIORITY
		            , A.REASON_CODE
		            , A.DESCRIPTION
		            , A.CREATE_DATE
		            , A.CREATE_BY
		            , A.UPDATE_DATE
		            , A.UPDATE_BY
		         FROM MOM_EQM_ORDER_REQUEST A
		            , MOM_EQUIPMENT ME
		        WHERE A.DIVISION_CD = ME.DIVISION_CD(+)
		          AND A.COMPANY_CD = ME.COMPANY_CD(+)
		          AND A.EQUIPMENT_CD = ME.EQUIPMENT_CD(+)
		          AND A.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		          AND A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		          AND NVL(ME.USE_YN, 'Y') = 'Y' 
		          AND A.PLAN_START_DATE BETWEEN TO_DATE(#{fromDate, jdbcType=VARCHAR},'YYYY-MM-DD') AND TO_DATE(#{toDate, jdbcType=VARCHAR},'YYYY-MM-DD') + 23.9997 / 24
                  <if test="equipmentCd != null and equipmentCd != ''">
                  AND A.EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR}
                  </if>
                  <if test="woType != null and woType != ''">
                  AND A.EQM_TYPE = #{woType, jdbcType=VARCHAR}
                  </if>
                  <if test="woId != null and woId != ''">
                  AND (A.EQM_WO_ID LIKE '%' || TRIM(UPPER(#{woId, jdbcType=VARCHAR})) || '%'
                   OR A.EQM_WO_NAME LIKE '%' || TRIM(UPPER(#{woId, jdbcType=VARCHAR})) || '%')
                  </if>
                  <if test="state != null and state != ''">
                  AND A.STATUS = #{state, jdbcType=VARCHAR}
                  </if>
		          )A
		 ORDER BY A.EQUIPMENT_NAME
		 <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
				)
	      SELECT A.*
	           , B.ROW_COUNT
	      FROM (SELECT A.*
	                 , ROWNUM GRIDROW
	              FROM TEMP1 A) A
	         , (SELECT COUNT(*) ROW_COUNT
	              FROM TEMP1) B 
	      WHERE GRIDROW BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
       </if>
	</select>

	<select id="get_equipmentBom_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT A.EQUIPMENT_CD
		     , A.ITEM_ID
		     , B.ITEM_NAME
		     , B.SPECIFICATION
		     , A.QTY
		     , '' AS REQUEST_DATE
		     , A.DESCRIPTION
		  FROM MOM_EQUIPMENT_BOM A
		     , MOM_ITEM_DEFINITION B
		 WHERE A.DIVISION_CD = B.DIVISION_CD
		   AND A.COMPANY_CD = B.COMPANY_CD
		   AND A.ITEM_ID = B.ITEM_ID
		   AND A.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND A.EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR}
		   AND NVL(A.USE_YN, 'Y') = 'Y'
		   AND NVL(B.USE_YN, 'Y') = 'Y'
	     ORDER BY A.EQUIPMENT_CD
	</select>
	
	<insert id="create_equipmentWoCreate" statementType="CALLABLE" parameterType="java.util.HashMap">
	{ CALL
      DECLARE
      	v_work_order_id  varchar2(40) := SP_MOM_EQUIPMENT_PKG.FN_GET_EQM_WO_REQUEST_ID(#{divisionCd, jdbcType=VARCHAR}
											  , #{companyCd, jdbcType=VARCHAR}
											  , #{eqmType, jdbcType=VARCHAR}
											  , TO_DATE(#{planStartDate, jdbcType=VARCHAR}, 'YYYY-MM-DD'));
      BEGIN
      		#{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} := 'E';
      		
		INSERT INTO MOM_EQM_ORDER_REQUEST
            (  DIVISION_CD
			 , COMPANY_CD
			 , EQM_TYPE
			 , EQM_WO_ID
			 , EQM_WO_NAME
			 , EQUIPMENT_CD
			 , EQM_QTY
			 , PLAN_START_DATE
			 , PLAN_END_DATE
			 , CANCEL_DATE
			 , STATUS
			 , PRIORITY
			 , REASON_CODE
			 , DESCRIPTION
			 , CREATE_DATE
			 , CREATE_BY
			 , UPDATE_DATE
			 , UPDATE_BY
			 , TID
			 )
        VALUES      
            (#{divisionCd, jdbcType=VARCHAR}
		   , #{companyCd, jdbcType=VARCHAR}
		   , #{eqmType, jdbcType=VARCHAR}
		   , v_work_order_id
		   , #{eqmWoName, jdbcType=VARCHAR}
		   , #{equipmentCd, jdbcType=VARCHAR}
		   , #{eqmQty, jdbcType=INTEGER}
		   , TO_DATE(#{planStartDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		   , TO_DATE(#{planEndDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		   , TO_DATE(#{cancelDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		   , 'R'
		   , #{priority, jdbcType=INTEGER}
		   , #{reasonCode, jdbcType=VARCHAR}
		   , #{description, jdbcType=VARCHAR}
		   , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		   , #{userId, jdbcType=VARCHAR}
		   , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		   , #{userId, jdbcType=VARCHAR}
		   , #{tid, jdbcType=VARCHAR}
            );
        
        INSERT INTO MOM_EQM_ORDER_REQUEST_HIST
            ( LAST_EVENT_SEQ
            , DIVISION_CD
            , COMPANY_CD
			, EQM_TYPE
			, EQM_WO_ID
			, EQM_WO_NAME
			, EQUIPMENT_CD
			, EQM_QTY
			, PLAN_START_DATE
			, PLAN_END_DATE
			, CANCEL_DATE
			, STATUS
			, PRIORITY
			, REASON_CODE
			, DESCRIPTION
			, CREATE_DATE
			, CREATE_BY
			, UPDATE_DATE
			, UPDATE_BY
			, TID )
        SELECT S_ORDER_SEQ.NEXTVAL 
        	 , DIVISION_CD
             , COMPANY_CD
			 , EQM_TYPE
			 , EQM_WO_ID
			 , EQM_WO_NAME
			 , EQUIPMENT_CD
			 , EQM_QTY
			 , PLAN_START_DATE 
			 , PLAN_END_DATE 
			 , CANCEL_DATE 
			 , STATUS 
			 , PRIORITY 
			 , REASON_CODE
			 , DESCRIPTION
			 , CREATE_DATE
			 , CREATE_BY
			 , UPDATE_DATE
			 , UPDATE_BY
			 , TID
          FROM MOM_EQM_ORDER_REQUEST
         WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
           AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
           AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
         ;
         
        SELECT
			CASE 
				WHEN COUNT(EQM_WO_ID) = 0 THEN 'E'
				ELSE 'S' 
			END  
			INTO #{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String}
		FROM MOM_EQM_ORDER_REQUEST
		WHERE 
			    EQM_WO_ID = v_work_order_id
			AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
            AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		;
        END
    }
	</insert>
	
	<update id="modify_equipmentWoCreate" statementType="CALLABLE" parameterType="java.util.HashMap">
	{ CALL
      DECLARE
      BEGIN
      	#{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} := 'E';
      	
		UPDATE MOM_EQM_ORDER_REQUEST
		   SET EQM_WO_NAME = #{eqmWoName, jdbcType=VARCHAR} 
		   	 , PLAN_START_DATE = TO_DATE(#{planStartDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		     , PLAN_END_DATE = TO_DATE(#{planEndDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		     , PRIORITY = #{priority, jdbcType=INTEGER}
		     , REASON_CODE = #{reasonCode, jdbcType=VARCHAR}
		     , DESCRIPTION = #{description, jdbcType=VARCHAR}
		     , UPDATE_DATE = MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		     , UPDATE_BY = #{updateBy, jdbcType=VARCHAR}
		 WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
		   AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		;
		
		INSERT INTO MOM_EQM_ORDER_REQUEST_HIST
            ( LAST_EVENT_SEQ
            , DIVISION_CD
            , COMPANY_CD
			, EQM_TYPE
			, EQM_WO_ID
			, EQM_WO_NAME
			, EQUIPMENT_CD
			, EQM_QTY
			, PLAN_START_DATE 
			, PLAN_END_DATE 
			, CANCEL_DATE 
			, STATUS 
			, PRIORITY 
			, REASON_CODE
			, DESCRIPTION
			, CREATE_DATE
			, CREATE_BY
			, UPDATE_DATE
			, UPDATE_BY
			, TID )
        SELECT S_ORDER_SEQ.NEXTVAL 
         	 , DIVISION_CD
             , COMPANY_CD
			 , EQM_TYPE
			 , EQM_WO_ID
			 , EQM_WO_NAME
			 , EQUIPMENT_CD
			 , EQM_QTY
			 , PLAN_START_DATE 
			 , PLAN_END_DATE 
			 , CANCEL_DATE 
			 , STATUS 
			 , PRIORITY 
			 , REASON_CODE
			 , DESCRIPTION
			 , CREATE_DATE
			 , CREATE_BY
			 , UPDATE_DATE
			 , UPDATE_BY
			 , TID
          FROM MOM_EQM_ORDER_REQUEST
         WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
           AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
           AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
         ;
		
        SELECT
			CASE 
				WHEN COUNT(EQM_WO_ID) = 0 THEN 'E'
				ELSE 'S' 
			END  
			INTO #{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String}
		FROM MOM_EQM_ORDER_REQUEST
		WHERE 
				EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
            AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
			AND COMPANY_CD  = #{companyCd, jdbcType=VARCHAR}
		;
        END
    }
	</update>
	
<!-- 	<insert id="create_equipmentWoCreateItem" statementType="CALLABLE" parameterType="java.util.HashMap"> -->
<!-- 	{ CALL -->
<!--       DECLARE -->
<!--       BEGIN -->
<!--       	#{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} := 'E';	  -->
      	
<!-- 		 INSERT INTO MOM_EQM_ITEM_REQUEST -->
<!--             ( DIVISION_CD -->
<!-- 			, COMPANY_CD -->
<!-- 			, EQM_WO_ID -->
<!-- 			, EQUIPMENT_CD -->
<!-- 			, ITEM_ID -->
<!-- 			, REQUEST_QTY -->
<!-- 			, REQUEST_DATE -->
<!-- 			, ISSUE_QTY -->
<!-- 			, CANCEL_QTY -->
<!-- 			, IN_LOCATION_CD -->
<!-- 			, OUT_LOCATION_CD -->
<!-- 			, REQUEST_TYPE -->
<!-- 			, DESCRIPTION -->
<!-- 			, CREATE_DATE -->
<!-- 			, CREATE_BY -->
<!-- 			, UPDATE_DATE -->
<!-- 			, UPDATE_BY -->
<!-- 			, TID -->
<!-- 			 ) -->
<!--         VALUES       -->
<!--             ( #{divisionCd, jdbcType=VARCHAR} -->
<!-- 			, #{companyCd, jdbcType=VARCHAR} -->
<!-- 			, #{eqmWoId, jdbcType=VARCHAR} -->
<!-- 			, #{equipmentCd, jdbcType=VARCHAR} -->
<!-- 			, #{itemId, jdbcType=VARCHAR} -->
<!-- 			, #{qty, jdbcType=INTEGER} -->
<!-- 			, #{requestDate, jdbcType=VARCHAR} -->
<!-- 			, #{issueQty, jdbcType=INTEGER} -->
<!-- 			, #{cancelQty, jdbcType=INTEGER} -->
<!-- 			, #{inLocationCd, jdbcType=VARCHAR} -->
<!-- 			, #{outLocationCd, jdbcType=VARCHAR} -->
<!-- 			, #{requestType, jdbcType=VARCHAR} -->
<!-- 			, #{description, jdbcType=VARCHAR} -->
<!-- 			, MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR}) -->
<!-- 			, #{userId, jdbcType=VARCHAR} -->
<!-- 			, MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR}) -->
<!-- 			, #{userId, jdbcType=VARCHAR} -->
<!-- 			, #{tid, jdbcType=VARCHAR} -->
<!-- 			); -->
        
<!--         INSERT INTO MOM_EQM_ITEM_REQUEST_HIST -->
<!--             ( LAST_EVENT_SEQ -->
<!--             , DIVISION_CD -->
<!-- 			, COMPANY_CD -->
<!-- 			, EQM_WO_ID -->
<!-- 			, EQUIPMENT_CD -->
<!-- 			, ITEM_ID -->
<!-- 			, REQUEST_QTY -->
<!-- 			, REQUEST_DATE -->
<!-- 			, ISSUE_QTY -->
<!-- 			, CANCEL_QTY -->
<!-- 			, IN_LOCATION_CD -->
<!-- 			, OUT_LOCATION_CD -->
<!-- 			, REQUEST_TYPE -->
<!-- 			, DESCRIPTION -->
<!-- 			, CREATE_DATE -->
<!-- 			, CREATE_BY -->
<!-- 			, UPDATE_DATE -->
<!-- 			, UPDATE_BY -->
<!-- 			, TID ) -->
<!--         SELECT S_ORDER_SEQ.NEXTVAL  -->
<!--              , DIVISION_CD -->
<!-- 			 , COMPANY_CD -->
<!-- 			 , EQM_WO_ID -->
<!-- 			 , EQUIPMENT_CD -->
<!-- 			 , ITEM_ID -->
<!-- 			 , REQUEST_QTY -->
<!-- 			 , REQUEST_DATE -->
<!-- 			 , ISSUE_QTY -->
<!-- 			 , CANCEL_QTY -->
<!-- 			 , IN_LOCATION_CD -->
<!-- 			 , OUT_LOCATION_CD -->
<!-- 			 , REQUEST_TYPE -->
<!-- 			 , DESCRIPTION -->
<!-- 			 , CREATE_DATE -->
<!-- 			 , CREATE_BY -->
<!-- 			 , UPDATE_DATE -->
<!-- 			 , UPDATE_BY -->
<!-- 			 , TID -->
<!--           FROM MOM_EQM_ITEM_REQUEST -->
<!--          WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR} -->
<!--            AND EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR} -->
<!--            AND ITEM_ID = #{itemId, jdbcType=VARCHAR} -->
<!--            AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} -->
<!--            AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} -->
<!--          ; -->
         
<!--        SELECT -->
<!-- 			CASE  -->
<!-- 				WHEN COUNT(EQM_WO_ID) = 0 THEN 'E' -->
<!-- 				ELSE 'S'  -->
<!-- 			END   -->
<!-- 			INTO #{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} -->
<!-- 		 FROM MOM_EQM_ITEM_REQUEST -->
<!--         WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR} -->
<!--           AND EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR} -->
<!--           AND ITEM_ID = #{itemId, jdbcType=VARCHAR} -->
<!--           AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} -->
<!--           AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} -->
<!--           ; -->
<!--      END -->
<!--      } -->
<!-- 	</insert> -->
	
	<delete id="remove_equipmentWoCreate" statementType="CALLABLE" parameterType="java.util.HashMap">
<!-- 	{ CALL -->
<!--       DECLARE -->
<!--       BEGIN -->
<!--       	#{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} := 'E'; -->
      	
<!--         INSERT INTO MOM_EQM_ORDER_REQUEST_HIST -->
<!--             ( LAST_EVENT_SEQ -->
<!--             , DIVISION_CD -->
<!--             , COMPANY_CD -->
<!-- 			, EQM_TYPE -->
<!-- 			, EQM_WO_ID -->
<!-- 			, EQM_WO_NAME -->
<!-- 			, EQUIPMENT_CD -->
<!-- 			, EQM_QTY -->
<!-- 			, START_DATE -->
<!-- 			, END_DATE -->
<!-- 			, EQM_STATUS -->
<!-- 			, REASON_CODE -->
<!-- 			, DESCRIPTION -->
<!-- 			, CREATE_DATE -->
<!-- 			, CREATE_BY -->
<!-- 			, UPDATE_DATE -->
<!-- 			, UPDATE_BY -->
<!-- 			, TID  ) -->
<!--         SELECT S_ORDER_SEQ.NEXTVAL  -->
<!--         	 , DIVISION_CD -->
<!--              , COMPANY_CD -->
<!-- 			 , EQM_TYPE -->
<!-- 			 , EQM_WO_ID -->
<!-- 			 , EQM_WO_NAME -->
<!-- 			 , EQUIPMENT_CD -->
<!-- 			 , EQM_QTY -->
<!-- 			 , START_DATE -->
<!-- 			 , END_DATE -->
<!-- 			 , EQM_STATUS -->
<!-- 			 , REASON_CODE -->
<!--              , 'Delete Data' -->
<!--              , CREATE_DATE -->
<!--              , CREATE_BY -->
<!--              , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR}) -->
<!--              , #{userId, jdbcType=VARCHAR} -->
<!--              , TID -->
<!--           FROM MOM_EQM_ORDER_REQUEST -->
<!--          WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR} -->
<!--            AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} -->
<!--            AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} -->
<!--          ; -->
		
<!-- 		DELETE FROM MOM_EQM_ORDER_REQUEST -->
<!-- 		 WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR} -->
<!-- 		   AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} -->
<!-- 		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} -->
<!-- 		; -->
         
<!-- 		SELECT -->
<!-- 			CASE  -->
<!-- 				WHEN COUNT(ITEM_ID) = 0 THEN 'S' -->
<!-- 				ELSE 'E'  -->
<!-- 			END   -->
<!-- 			INTO #{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} -->
<!-- 		FROM MOM_EQM_ORDER_REQUEST -->
<!-- 		WHERE  -->
<!-- 			   EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR} -->
<!-- 		   AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} -->
<!-- 		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR} -->
<!-- 		; -->
<!-- 		END -->
<!--     }		 -->
	{ CALL
      DECLARE
      BEGIN
      	#{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String} := 'E';
      	
		UPDATE MOM_EQM_ORDER_REQUEST
		   SET STATUS = 'C'
		     , CANCEL_DATE = TO_DATE(#{cancelDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		     , UPDATE_DATE = MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		     , UPDATE_BY = #{updateBy, jdbcType=VARCHAR}
		 WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
		   AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		;
		
		INSERT INTO MOM_EQM_ORDER_REQUEST_HIST
            ( LAST_EVENT_SEQ
            , DIVISION_CD
            , COMPANY_CD
			, EQM_TYPE
			, EQM_WO_ID
			, EQM_WO_NAME
			, EQUIPMENT_CD
			, EQM_QTY
			, PLAN_START_DATE 
			, PLAN_END_DATE 
			, CANCEL_DATE 
			, STATUS 
			, PRIORITY 
			, REASON_CODE
			, DESCRIPTION
			, CREATE_DATE
			, CREATE_BY
			, UPDATE_DATE
			, UPDATE_BY
			, TID )
        SELECT S_ORDER_SEQ.NEXTVAL 
         	 , DIVISION_CD
             , COMPANY_CD
			 , EQM_TYPE
			 , EQM_WO_ID
			 , EQM_WO_NAME
			 , EQUIPMENT_CD
			 , EQM_QTY
			 , PLAN_START_DATE 
			 , PLAN_END_DATE 
			 , CANCEL_DATE 
			 , STATUS 
			 , PRIORITY 
			 , REASON_CODE
			 , DESCRIPTION
			 , CREATE_DATE
			 , CREATE_BY
			 , UPDATE_DATE
			 , UPDATE_BY
			 , TID
          FROM MOM_EQM_ORDER_REQUEST
         WHERE EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
           AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
           AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
         ;
		
        SELECT
			CASE 
				WHEN COUNT(EQM_WO_ID) = 0 THEN 'E'
				ELSE 'S' 
			END  
			INTO #{p_err_code, mode=OUT, jdbcType=VARCHAR, javaType=String}
		FROM MOM_EQM_ORDER_REQUEST
		WHERE 
				EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
            AND DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
			AND COMPANY_CD  = #{companyCd, jdbcType=VARCHAR}
		;
        END
    }
	</delete>
	
	<delete id="remove_equipmentWoConfirmTemp" parameterType="java.util.HashMap">
		DELETE 
		  FROM MOM_EQM_ORDER_REQUEST_TMP
 		 WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
   		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
   		   AND WO_FLAG = 'CONFIRM'
	</delete>
	
	<insert id="create_equipmentWoConfirmTemp" parameterType="java.util.HashMap">
	INSERT INTO MOM_EQM_ORDER_REQUEST_TMP
			( DIVISION_CD
			, COMPANY_CD
			, EQM_TYPE
			, EQM_WO_ID
			, EQM_WO_NAME
			, EQUIPMENT_CD
			, EQM_QTY
			, PLAN_START_DATE
			, PLAN_END_DATE
			, STATUS
			, REASON_CODE
			, DESCRIPTION
			, CREATE_DATE
			, CREATE_BY
			, PRIORITY
			, WO_FLAG
			)
		SELECT DIVISION_CD
			 , COMPANY_CD
			 , EQM_TYPE
			 , EQM_WO_ID
			 , EQM_WO_NAME
			 , EQUIPMENT_CD
			 , EQM_QTY
			 , PLAN_START_DATE
			 , PLAN_END_DATE
			 , STATUS
			 , REASON_CODE
			 , DESCRIPTION
			 , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})
		     , #{updateBy, jdbcType=VARCHAR}
			 , PRIORITY
			 , 'CONFIRM'
		  FROM MOM_EQM_ORDER_REQUEST
		 WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND EQM_WO_ID = #{eqmWoId, jdbcType=VARCHAR}
	</insert>
	
	<insert id="create_equipmentWoConfirm" statementType="CALLABLE">
	{
        CALL SP_MOM_EQUIPMENT_PKG.P_CREATE_WORK_ORDER (
            #{p_err_code, mode=OUT, jdbcType=VARCHAR}
           ,#{p_err_msg, mode=OUT, jdbcType=VARCHAR}
           ,#{divisionCd, mode=IN, jdbcType=VARCHAR}
           ,#{companyCd, mode=IN, jdbcType=VARCHAR}
           ,#{userId, mode=IN, jdbcType=VARCHAR}
        )
    }
	</insert>
	
	<select id="get_equipmentWoId_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT SP_MOM_EQUIPMENT_PKG.FN_GET_EQM_WO_REQUEST_ID(#{divisionCd, jdbcType=VARCHAR}
											  , #{companyCd, jdbcType=VARCHAR}
											  , #{eqmType, jdbcType=VARCHAR}
											  , TO_DATE(#{planStartDate, jdbcType=VARCHAR}, 'YYYY-MM-DD') ) AS EQM_WO_ID 
		  FROM DUAL
	</select>
	
	<select id="get_equipment_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT EQUIPMENT_CD AS CODE
		     , EQUIPMENT_NAME AS NAME
		  FROM MOM_EQUIPMENT
		 WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND NVL(USE_YN, 'N') = 'Y'
		 ORDER BY NAME
	</select>
</mapper>