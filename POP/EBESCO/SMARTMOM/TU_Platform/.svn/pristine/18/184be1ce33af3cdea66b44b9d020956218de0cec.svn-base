<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.close.monthlyClosingCancel">
	<select id="get_monthlyClosingCancel_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT ML.MAGAM_SEQ
		     , ML.INOUT_FLAG
		     , MC1.CODE_NAME INOUT_NAME
		     , ML.MAGAM_TYPE
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(ML.DIVISION_CD, ML.COMPANY_CD, 'IO_CATEGORY', ML.MAGAM_TYPE) FROM DUAL) MAGAM_TYPE_NAME
		     , ML.MAGAM_AMOUNT
		     , ML.MAGAM_VAT
		     , ML.MAGAM_TOTAL_AMOUNT
		     , ML.VENDOR_CD
		     , MV.VENDOR_NAME
		     , MV.BUSINESS_NO
		     , NVL(ML.IF_SEND_YN, 'N') IF_SEND_YN
		     , ML.ERP_NO
		     , NVL(MC1.ATTRIBUTE1, 'N') AS IF_DATA_YN
		  FROM MOM_ITEM_LAST_VNDRSUM ML
		     , MOM_VENDOR MV
		     , (SELECT CODE_ID, CODE_NAME, ATTRIBUTE1
		          FROM MOM_CODE 
		         WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR} AND CODE_CLASS_ID = 'MAGAM_IO_FLAG') MC1
		 WHERE ML.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		 <if test="closingMonth != null and closingMonth != ''">
		  AND ML.MAGAM_YYYYMM = #{closingMonth, jdbcType=VARCHAR}
		 </if>
		 <if test="psFlag != null and psFlag != ''"> 
		  AND ML.INOUT_FLAG = #{psFlag, jdbcType=VARCHAR}
		 </if>
		  AND ML.VENDOR_CD = MV.VENDOR_CD
		  AND ML.DIVISION_CD = MV.DIVISION_CD
		  AND ML.INOUT_FLAG = MC1.CODE_ID(+)
		 <if test = "ifFlag != null and ifFlag != ''">
		  AND NVL(ML.IF_SEND_YN, 'N') = #{ifFlag, jdbcType=VARCHAR}
		 </if>
		 <if test ="vendorName != null and vendorName !=''">
		  AND ML.VENDOR_CD = #{vendorName, jdbcType=VARCHAR}
		 </if>
		 ORDER BY ML.VENDOR_CD, ML.INOUT_FLAG, ML.MAGAM_TYPE
	</select>
	
	<insert id="create_monthlyVendorCloseCancel" statementType="CALLABLE">
	{
		CALL P_MONTHLY_VENDOR_CLOSE_C ( 
			 #{p_err_code, mode=OUT, jdbcType=VARCHAR}
           , #{p_err_msg, mode=OUT, jdbcType=VARCHAR}
           , #{divisionCd, mode=IN, jdbcType=VARCHAR}
           , #{companyCd, mode=IN, jdbcType=VARCHAR}
           , #{magamSeq, mode=IN, jdbcType=VARCHAR}
           , #{createBy, mode=IN, jdbcType=VARCHAR}
		)
	}
	</insert>
	
</mapper>