<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.reference.workinghours.shift">
	<select id="get_shift_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT A.DIVISION_CD
		     , A.COMPANY_CD
		     , A.SHIFT_ID
		     , A.SHIFT_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME( A.DIVISION_CD, A.COMPANY_CD, 'SHIFT_CODE', A.SHIFT_CD)
		          FROM DUAL) AS SHIFT_CD_NAME
		     , TO_CHAR(TO_DATE(A.START_TIME, 'HH24:MI:SS'), 'HH24:MI:SS') AS START_TIME
		     , TO_CHAR(TO_DATE(A.END_TIME, 'HH24:MI:SS'), 'HH24:MI:SS') AS END_TIME
		     , TO_CHAR(A.APPLY_STATE_TIME, 'YYYY-MM-DD') AS APPLY_STATE_TIME
		     , TO_CHAR(A.APPLY_END_TIME, 'YYYY-MM-DD') AS APPLY_END_TIME
		     , A.RESOURCE_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_RESOURCE_NAME( A.DIVISION_CD , A.COMPANY_CD , A.RESOURCE_CD)
		          FROM DUAL) AS RESOURCE_NAME
		     , A.NORMAL_IN_WORK_HOUR
		     , A.NORMAL_DR_WORK_HOUR
		     , A.EXTRA_IN_WORK_HOUR
		     , A.EXTRA_DR_WORK_HOUR
		     , A.NORMAL_IN_PERSON_CNT	
		     , A.NORMAL_DR_PERSON_CNT
		     , A.EXTRA_IN_PERSON_CNT
		     , A.EXTRA_DR_PERSON_CNT
		     , A.NORMAL_IN_AC_HOUR
		     , A.NORMAL_DR_AC_HOUR
		     , A.EXTRA_IN_AC_HOUR
		     , A.EXTRA_DR_AC_HOUR
		     , A.USE_YN
		     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME( A.DIVISION_CD
		                                              , A.COMPANY_CD  
		                                              , 'USE_FLAG'
		                                              , A.USE_YN)
		          FROM DUAL) AS USE_YN_NAME
		     , A.DESCRIPTION
		     , A.CREATE_BY
		     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME( A.DIVISION_CD, A.COMPANY_CD, A.CREATE_BY)
		          FROM DUAL) AS CREATE_USER_NAME
		     , TO_CHAR(A.UPDATE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS UPDATE_DATE
		     , A.UPDATE_BY
		     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME( A.DIVISION_CD, A.COMPANY_CD, A.UPDATE_BY)
		          FROM DUAL) AS UPDATE_USER_NAME
		FROM   MOM_SHIFT A
		WHERE  A.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		  AND  A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		  AND  TO_CHAR(A.APPLY_END_TIME,'YYYY-MM-DD') >= #{endDate, jdbcType=VARCHAR}
	     <if test="shiftName != null and shiftName != ''">
		  AND  SHIFT_CD = #{shiftName, jdbcType=VARCHAR}
	     </if>
	     <if test="resourceName != null and resourceName != ''">
		  AND  RESOURCE_CD = #{resourceName, jdbcType=VARCHAR}
	     </if>
		ORDER BY A.RESOURCE_CD, A.APPLY_STATE_TIME
	</select>
	
	<select id="get_shift" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT *
		  FROM  MOM_SHIFT 
		 WHERE  DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND  COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND  TO_CHAR(APPLY_END_TIME,'YYYY-MM-DD') >= #{endDate, jdbcType=VARCHAR}
	</select>
	
	<insert id="create_shift" statementType="CALLABLE">
	{
        CALL P_CREATE_MOM_SHIFT (
            #{p_err_code, mode=OUT, jdbcType=VARCHAR}
           ,#{p_err_msg, mode=OUT, jdbcType=VARCHAR}
           ,#{divisionCd, mode=IN, jdbcType=VARCHAR}
           ,#{companyCd, mode=IN, jdbcType=VARCHAR}
           ,#{actionType, mode=IN, jdbcType=VARCHAR}
           ,#{shiftId, mode=IN, jdbcType=VARCHAR}
           ,#{shiftCd, mode=IN, jdbcType=VARCHAR}
           ,#{startTime, mode=IN, jdbcType=VARCHAR}
           ,#{endTime, mode=IN, jdbcType=VARCHAR}
           ,TO_DATE(#{applyStateTime, mode=IN, jdbcType=VARCHAR}, 'YYYY-MM-DD')
           ,TO_DATE(#{applyEndTime, mode=IN, jdbcType=VARCHAR}, 'YYYY-MM-DD')
           ,#{resourceCd, mode=IN, jdbcType=VARCHAR}
           ,#{normalInWorkHour, mode=IN, jdbcType=INTEGER}
           ,#{normalDrWorkHour, mode=IN, jdbcType=INTEGER}
           ,#{extraInWorkHour, mode=IN, jdbcType=INTEGER}
           ,#{extraDrWorkHour, mode=IN, jdbcType=INTEGER}
           ,#{normalInPersonCnt, mode=IN, jdbcType=INTEGER}
           ,#{normalDrPersonCnt, mode=IN, jdbcType=INTEGER}
           ,#{extraInPersonCnt, mode=IN, jdbcType=INTEGER}
           ,#{extraDrPersonCnt, mode=IN, jdbcType=INTEGER}
           ,#{normalInAcHour, mode=IN, jdbcType=INTEGER}
           ,#{normalDrAcHour, mode=IN, jdbcType=INTEGER}
           ,#{extraInAcHour, mode=IN, jdbcType=INTEGER}
           ,#{extraDrAcHour, mode=IN, jdbcType=INTEGER}
           ,#{description, mode=IN, jdbcType=VARCHAR}
           ,NVL(#{useYn, mode=IN, jdbcType=VARCHAR}, 'Y')
           ,#{updateBy, mode=IN, jdbcType=VARCHAR}
        )
    }
	</insert>

	<!-- resource 콤보리스트(검색조건, 팝업) -->
	<select id="get_shift_resource_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT RESOURCE_CD AS CODE
		     , RESOURCE_CD||'('||RESOURCE_NAME ||')' 	AS NAME
		FROM   MOM_RESOURCE
		WHERE  1 = 1
		AND    DIVISION_CD = #{divisionCd,jdbcType=VARCHAR}
		AND    COMPANY_CD  = #{companyCd,jdbcType=VARCHAR}
		AND    NVL(USE_YN, 'Y') = 'Y'
		ORDER BY CODE
    </select>

</mapper>