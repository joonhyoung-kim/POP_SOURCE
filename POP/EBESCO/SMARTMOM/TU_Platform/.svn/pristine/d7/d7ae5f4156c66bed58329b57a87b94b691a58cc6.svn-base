<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.plan.order.ospIssue">
	<select id="get_ospIssue_list" resultType="camelMap" parameterType="java.util.HashMap">
	WITH TEMP1 AS (
	 SELECT SEND_SEQ
	     , INTERFACE_ID
	     , WORK_DATE
	     , ORGANIZATION_ID
	     , ORGANIZATION_CODE
	     , VENDOR_SITE_ID
	     , VENDOR_SITE_CODE
	     , VENDOR_NAME
	     , LINE_CODE
	     , LINE_NAME
	     , PART_NO
	     , WIP_ENTITY_NAME
	     , TRANSACTION_DATE
	     , TRANSACTION_TYPE_NAME
	     , TRANSACTION_SOURCE_TYPE_NAME
	     , ISSUE_TYPE_CODE
	     , IN_OUT_TYPE_CODE
	     , ITEM_TYPE
	     , PRIMARY_UOM_CODE
	     , ISSUED_QUANTITY
	     , ENDING_PERIODIC_COST
	     , ISSUE_AMOUNT
	     , SALES_PRICE
	     , SALES_AMOUNT
	     , ITEM_DESC
	     , ITEM_SPEC
	     , SUBINVENTORY_CODE
	     , SUBINVENTORY_DESC
	     , ASSEMBLY_PART_NO
	     , MARKET_CODE
	     , TAKEOVER_STATUS
	     , TAKEOVER_DATE
	     , TAKEOVER_USER
	     , CREATION_DATE
	     , CREATED_BY
	     , IF_ATTRIBUTE1
	     , IF_ATTRIBUTE2
	     , IF_ATTRIBUTE3
	     , IF_ATTRIBUTE4
	     , IF_ATTRIBUTE5
	     , IF_ATTRIBUTE6
	     , IF_ATTRIBUTE7
	     , IF_ATTRIBUTE8
	     , IF_ATTRIBUTE9
	     , IF_ATTRIBUTE10
	     , IF_ATTRIBUTE11
	     , IF_ATTRIBUTE12
	     , IF_ATTRIBUTE13
	     , IF_ATTRIBUTE14
	     , IF_ATTRIBUTE15
	     , IF_ATTRIBUTE16
	     , IF_ATTRIBUTE17
	     , IF_ATTRIBUTE18
	     , IF_ATTRIBUTE19
	     , IF_ATTRIBUTE20
	     , TRANSFER_FLAG
	     , TRANSFER_DATE
	     , STEP_CODE
	     , STEP_STATUS_CODE
	  FROM TU_EAI.IF_LGE_SUP_OSP_ISSUE_RESULT 
	  WHERE 1 = 1
	  <if test = "fromDate != null and fromDate != '' and toDate != null and toDate != ''">
	  AND TRANSACTION_DATE BETWEEN TO_DATE(#{fromDate, jdbcType=VARCHAR}, 'YYYY-MM-DD') 
	                           AND (TO_DATE(#{toDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')+ 23.9997 / 24)
	  </if>
	  <if test = "orgCode != null and orgCode != ''">
	  AND ORGANIZATION_CODE = #{orgCode, jdbcType=VARCHAR}
	  </if>
	  <if test = "itemName != null and itemName != ''">
	  AND (PART_NO LIKE '%' || TRIM(UPPER(#{itemId, jdbcType=VARCHAR})) || '%'
		   OR UPPER(ITEM_DESC) LIKE '%' || TRIM(UPPER(#{itemId, jdbcType=VARCHAR})) || '%') <!-- XMOMG64 / pyj / 검색조건 품명 추가 및 UPPER처리 -->
	  </if>
	  AND VENDOR_SITE_CODE = (SELECT P.B2BI_VENDOR_CD 
                                   FROM   MOM_PARAMETER P
                                   WHERE  P.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR})
	  ORDER BY TRANSACTION_DATE DESC )
	  SELECT A.*
           , B.ROW_COUNT
      FROM (SELECT A.*
                 , ROWNUM GRIDROW
              FROM TEMP1 A) A
         , (SELECT COUNT(*) ROW_COUNT
              FROM TEMP1) B 
		<if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
	  WHERE GRIDROW BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
	    </if>
	</select>
	
<!-- 	<select id="get_ospIssueCount_list" resultType="camelMap" parameterType="java.util.HashMap"> -->
<!-- 	    SELECT count(*) AS ROW_COUNT -->
<!--           FROM TU_EAI.IF_LGE_SUP_OSP_ISSUE_RESULT -->
<!--          WHERE 1=1 -->
<!--          <if test = "fromDate != null and fromDate != '' and toDate != null and toDate != ''"> -->
<!-- 		 AND TRUNC(TRANSACTION_DATE) BETWEEN TO_DATE(#{fromDate, jdbcType=VARCHAR}, 'YYYY-MM-DD') AND (TO_DATE(#{toDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')+ 23.999 / 24) -->
<!-- 		 </if> -->
<!-- 		 <if test = "orgCode != null and orgCode != ''"> -->
<!-- 		 AND ORGANIZATION_CODE = #{orgCode, jdbcType=VARCHAR} -->
<!-- 		 </if> -->
<!-- 		 <if test = "itemName != null and itemName != ''"> -->
<!-- 		 AND PART_NO = #{itemName, jdbcType=VARCHAR} -->
<!-- 		 </if> -->
<!-- 		 AND VENDOR_SITE_CODE = (SELECT P.B2BI_VENDOR_CD  -->
<!--                                    FROM   MOM_PARAMETER P -->
<!--                                    WHERE  P.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}) -->
<!-- 	</select> -->

	<insert id="create_b2biOspIssue" statementType="CALLABLE">
	{
        CALL MOM_B2BI.CREATE_B2BI_OSP_ISSUE (
             #{p_err_code, mode=OUT, jdbcType=VARCHAR}
           , #{p_err_msg, mode=OUT, jdbcType=VARCHAR}
           , #{divisionCd, mode=IN, jdbcType=VARCHAR}
           , #{companyCd, mode=IN, jdbcType=VARCHAR}
           , TO_DATE(#{fromDate, mode=IN, jdbcType=VARCHAR}, 'YYYY-MM-DD')
           , TO_DATE(#{toDate, mode=IN, jdbcType=VARCHAR}, 'YYYY-MM-DD')
           , #{userId, mode=IN, jdbcType=VARCHAR}
        )
    }
	</insert>

</mapper>