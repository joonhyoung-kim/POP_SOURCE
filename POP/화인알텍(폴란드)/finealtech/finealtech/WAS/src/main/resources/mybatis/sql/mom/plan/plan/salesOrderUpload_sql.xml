<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.plan.plan.salesOrderUpload">
	<!-- 영업마스터 업로드, PO, ItemPO -->
    <delete id="remove_salesOrderUpload" parameterType="java.util.HashMap">
		DELETE
		FROM MOM_BUFFER_DEMAND
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND PLAN_DATE = #{planDate, jdbcType=VARCHAR}
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
	</delete>

	<insert id="create_salesOrderUpload" parameterType="java.util.HashMap">
		INSERT INTO MOM_BUFFER_DEMAND (
			DIVISION_CD
		  , PLAN_DATE
		  , UPLOAD_TYPE
		<if test="key != '' and key != null">
			${key}
		</if>
		)
		VALUES (
			#{divisionCd, jdbcType=VARCHAR}
		   , TO_CHAR(SYSDATE,'YYYYMMDD')
		   , #{uploadType, jdbcType=VARCHAR}
		<if test="value != '' and value != null">
			${value}
		</if>
		)
	</insert>

	<update id="modify_salesOrderUpload" parameterType="java.util.HashMap">
		UPDATE MOM_BUFFER_DEMAND
		SET ATTR1 = #{attr1, jdbcType=VARCHAR}
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND TO_CHAR(PLAN_DATE, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
		AND 1 = 2
	</update>

	<insert id="create_salesOrderUploadProc" statementType="CALLABLE" parameterType="java.util.HashMap">
		{
			CALL SP_DYNAMIC_DEMAND (
			#{p_err_code, mode=OUT, jdbcType=VARCHAR}
			, #{p_err_msg, mode=OUT, jdbcType=VARCHAR}
			, #{divisionCd, mode=IN, jdbcType=VARCHAR}
			, #{companyCd, mode=IN, jdbcType=VARCHAR}
			, #{planDate, mode=IN, jdbcType=VARCHAR}
			, #{uploadType, mode=IN, jdbcType=VARCHAR}
			, #{salesCustomer, mode=IN, jdbcType=VARCHAR}
			)
		}
	</insert>

	<select id="get_salesOrderUpload_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT *
		FROM MOM_BUFFER_DEMAND
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND PLAN_DATE = #{planDate, jdbcType=VARCHAR}
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
	</select>
	
	<select id="get_salesOrderUploadExcelSample_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT * FROM MOM_DEMAND_CONFIG
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
		AND BUFFER_DEMAND_USE_FLAG ='Y'
		ORDER BY UPLOAD_DEMAND_SEQ
	</select>
	
	<select id="get_salesOrderUploadConfig_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT * FROM MOM_DEMAND_CONFIG
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
		AND MOM_DEMAND_USE_FLAG ='Y'
		ORDER BY UPLOAD_DEMAND_SEQ
	</select>
	
    <insert id="create_salesOrderUploadCreateProc" statementType="CALLABLE" parameterType="java.util.HashMap">
		{
			CALL SP_TAR_DEMAND (
			#{p_err_code, mode=OUT, jdbcType=VARCHAR}
			, #{p_err_msg, mode=OUT, jdbcType=VARCHAR}
			, #{divisionCd, mode=IN, jdbcType=VARCHAR}
			, #{companyCd, mode=IN, jdbcType=VARCHAR}
			, #{planDate, mode=IN, jdbcType=VARCHAR}
			, #{userId, mode=IN, jdbcType=VARCHAR}
			)
		}
	</insert>
	
	<insert id="create_tarDemandCreateProc" statementType="CALLABLE" parameterType="java.util.HashMap">
        {
            CALL SP_TAR_DEMAND_ONLY (
            #{p_err_code, mode=OUT, jdbcType=VARCHAR}
            , #{p_err_msg, mode=OUT, jdbcType=VARCHAR}
            , #{divisionCd, mode=IN, jdbcType=VARCHAR}
            , #{companyCd, mode=IN, jdbcType=VARCHAR}
            , #{planDate, mode=IN, jdbcType=VARCHAR}
            , #{userId, mode=IN, jdbcType=VARCHAR}
            )
        }
    </insert>
	
	<select id="get_getDueDate_list" resultType="camelMap" parameterType="java.util.HashMap">
	SELECT TO_CHAR(SOLAR_DATE, 'YYYYMMDD') DUE_DATE
         , DAY
         , DECODE(DAY, #{MESSAGES30013, jdbcType=VARCHAR}, 'Mon' , #{MESSAGES30002, jdbcType=VARCHAR}, 'Tue' , #{MESSAGES30009, jdbcType=VARCHAR}, 'Wed' , #{MESSAGES30069, jdbcType=VARCHAR}, 'Thu' , #{MESSAGES30070, jdbcType=VARCHAR}, 'Fri' , #{MESSAGES30071, jdbcType=VARCHAR}, 'Sat' , #{MESSAGES30072, jdbcType=VARCHAR}, 'Sun') AS EDAY
    FROM MOM_CALENDA A
         , (SELECT MIN(DUE_DATE) START_DATE
         , MAX(DUE_DATE) END_DATE
            FROM MOM_DEMAND A
            WHERE TO_CHAR(PLAN_DATE, 'YYYY-MM-DD') = #{planDate, jdbcType=VARCHAR} AND division_cd = #{divisionCd, jdbcType=VARCHAR} AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}) B
    WHERE A.SOLAR_DATE &gt;= START_DATE
    AND A.SOLAR_DATE &lt;= END_DATE
	</select>
	
	<select id="get_salesOrderUploadCreate_list" resultType="camelMap" parameterType="java.util.HashMap">
		 SELECT TO_CHAR(PLAN_DATE,'YYYY-MM-DD') AS PLAN_DATE
		 <if test= "dataString != null and dataString != ''">
		 , ${dataString}
		 </if>
		 <if test= "colDate != null and colDate != ''">
		 , ${colDate}
		 </if>
		FROM MOM_DEMAND
		WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND PLAN_DATE = TO_DATE(#{planDate, jdbcType=VARCHAR}, 'YYYY-MM-DD')
		AND UPLOAD_TYPE = #{uploadType, jdbcType=VARCHAR}
		<if test= "optionValue != null and optionValue != ''">
		GROUP BY PLAN_DATE, ${dataString}
		</if>
		ORDER BY DUE_DATE ASC
	</select>

	<select id="get_salesOrderUploadOptionValueType_list" resultType="camelMap" parameterType="java.util.HashMap">
	   SELECT CODE_VALUES  AS OPTION_VALUE
       FROM   MOM_CODE
       WHERE  DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
       AND    COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
<!--        AND    CODE_ID = 'DEMAND_EXCEL_UPLOAD_TYPE' -->
       AND    CODE_ID = #{codeId, jdbcType=VARCHAR}
	</select>
</mapper>