<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.purchase.materialLedger.materialDeliveryPassIn">
	<select id="get_materialDeliveryPassIn_list" resultType="camelMap" parameterType="java.util.HashMap">
SELECT MO.ORDER_GROUP_ID
     , MO.ORDER_SEQ
     , MV.DEPARTURE_FLAG
     , MO.MATERIAL_ORDER_ID
     , MO.VENDOR_CD
     , MV.VENDOR_NAME
     , NVL(MO.DEPARTURE_VENDOR_CD, MO.VENDOR_CD) AS DEPARTURE_VENDOR_CD
     , (SELECT MOM_COMMON_PKG.FN_GET_VENDOR_NAME(MO.DIVISION_CD
                                                ,MO.COMPANY_CD
                                                ,NVL(MO.DEPARTURE_VENDOR_CD, MO.VENDOR_CD) )
        FROM  DUAL)     AS DEPARTURE_VENDOR_NAME 
     , MO.ITEM_ID
     , MID.ITEM_NAME
     , MID.SPECIFICATION
     , MID.ITEM_TYPE
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'ITEM_TYPE'
                                              ,MID.ITEM_TYPE )
        FROM DUAL)                            AS ITEM_TYPE_NAME      
     , MID.UNIT
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'ITEM_UNIT'
                                              ,MID.UNIT )
        FROM DUAL)                            AS UNIT_NAME     
     , MO.ORDER_QTY
     , NVL(MO.CANCEL_QTY, 0)  AS CANCEL_QTY  
     , NVL(MO.LOCATION_CD, MID.IN_LOCATION_ID)  AS LOCATION_CD
     , (SELECT MOM_COMMON_PKG.FN_GET_FACILITY_NAME(MO.DIVISION_CD
                                                  ,MO.COMPANY_CD
                                                  ,NVL(MO.LOCATION_CD, MID.IN_LOCATION_ID))
        FROM   DUAL )     AS LOCATION_NAME
     , MO.MARKET_CD
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'MARKET_CODE'
                                              ,MO.MARKET_CD )
        FROM DUAL)                            AS MARKET_NAME       
     , MO.CURRENCY_CD
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'CURRENCY_CD'
                                              ,MO.CURRENCY_CD )
        FROM DUAL)                            AS CURRENCY_NAME
     , (SELECT MOM_COMMON_PKG.FN_GET_MATERIAL_PRICE(MO.DIVISION_CD
                                                   ,MO.COMPANY_CD
                                                   ,MO.VENDOR_CD
                                                   ,MO.ITEM_ID
                                                   ,MO.MARKET_CD
                                                   ,MO.CURRENCY_CD
                                                   ,TRUNC(MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})) )
        FROM DUAL)                            AS UNIT_PRICE
     , (SELECT MOM_COMMON_PKG.FN_GET_CURRENT_EXCHANGE_RATE(MO.DIVISION_CD
                                                          ,MO.COMPANY_CD
                                                          ,MO.CURRENCY_CD
                                                          ,TRUNC(MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})) )
        FROM DUAL)                            AS EX_UNIT_PRICE 
     , TO_CHAR(MO.ORDER_DATE , 'YYYY-MM-DD')       AS ORDER_DATE  
     , TO_CHAR(TRUNC(MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{divisionCd, jdbcType=VARCHAR}, #{companyCd, jdbcType=VARCHAR})), 'YYYY-MM-DD')       AS IO_TIME
     , MO.DESCRIPTION                   
     , (SELECT MOM_COMMON_PKG.FN_GET_MATERIAL_INPUT_QTY(MO.DIVISION_CD
                                                       ,MO.COMPANY_CD
                                                       ,MO.MATERIAL_ORDER_ID) 
        FROM  DUAL)                            AS IO_QTY
     , (SELECT MOM_COMMON_PKG.FN_GET_UNIT_DECIMAL_POINT_FLAG(MO.DIVISION_CD
                                                            ,MO.COMPANY_CD
                                                            ,MID.UNIT)
        FROM DUAL)                            AS UNIT_DP_USE_FLAG                
     , MO.ORDER_STATE   
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'MATERIAL_ORDER_STATE'
                                              ,MO.ORDER_STATE )
        FROM DUAL)                            AS ORDER_STATE_NAME       
     , MID.IQC_FLAG   
     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MO.DIVISION_CD
                                              ,MO.COMPANY_CD
                                              ,'USE_FLAG'
                                              ,MID.IQC_FLAG )
        FROM DUAL)                            AS IQC_FLAG_NAME    
     , <!-- (SELECT MIN(R.JUDGMENET_ID)
        FROM   MOM_DEFECT_RESULT R
        WHERE  MO.DIVISION_CD = R.DIVISION_CD
        AND    MO.COMPANY_CD  = R.COMPANY_CD
        AND    R.MATERIAL_ORDER_ID = MO.MATERIAL_ORDER_ID) --> NULL   AS JUDGMENET_ID             
FROM   MOM_MATERIAL_ORDER MO
     , MOM_ITEM_DEFINITION MID
     , MOM_VENDOR MV
WHERE  MO.DIVISION_CD = MID.DIVISION_CD
AND    MO.COMPANY_CD  = MID.COMPANY_CD
AND    MO.ITEM_ID     = MID.ITEM_ID     
AND    MO.DIVISION_CD = MV.DIVISION_CD
AND    MO.COMPANY_CD  = MV.COMPANY_CD
AND    MO.VENDOR_CD   = MV.VENDOR_CD
AND    MV.DEPARTURE_FLAG = 'N'
AND    MO.DIVISION_CD  = #{divisionCd, jdbcType=VARCHAR}
AND    MO.COMPANY_CD   = #{companyCd, jdbcType=VARCHAR}
<if test="fromDate != null and fromDate != ''">
AND    MO.ORDER_DATE BETWEEN TO_DATE(#{fromDate, jdbcType=VARCHAR}, 'yyyy-mm-dd') 
                         AND     TO_DATE(#{toDate, jdbcType=VARCHAR}, 'yyyy-mm-dd') 
</if>
<if test="vendorCd != null and vendorCd != ''">
AND	   MO.VENDOR_CD = #{vendorCd, jdbcType=VARCHAR}
</if>
<if test="departureVendorCd != null and departureVendorCd != ''">
AND	  MO.DEPARTURE_VENDOR_CD = #{departureVendorCd, jdbcType=VARCHAR}
</if>
<if test="itemId != null and itemId != ''">
AND (UPPER(MO.ITEM_ID) LIKE '%' || UPPER(#{itemId, jdbcType=VARCHAR}) || '%' 
    OR UPPER(MID.ITEM_NAME) LIKE '%' || UPPER(#{itemId, jdbcType=VARCHAR}) || '%')
</if>
<if test="orderState != null and orderState != ''">
AND MO.ORDER_STATE = #{orderState, jdbcType=VARCHAR}
</if>
AND    MO.ORDER_STATE IN ('ORDER', 'CHECK', 'PASS')
ORDER BY MO.ORDER_SEQ               

	</select>


	
</mapper>