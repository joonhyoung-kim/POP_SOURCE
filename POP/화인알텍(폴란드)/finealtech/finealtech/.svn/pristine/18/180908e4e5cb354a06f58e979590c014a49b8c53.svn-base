<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.shipping.shipPlanningStatus">
	<select id="get_shipPlanningStatus_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT MSP.DIVISION_CD
		     , MSP.COMPANY_CD
		     , MSP.SHIPMENT_GROUP_ID     
		     , MSP.SHIPMENT_SEQ_NO
		     , MSP.CUSTOMER_WO_ID
		     , MSP.CUSTOMER_PO_ID
		     , MSP.CUSTOMER_ORG_CODE
		     , MSP.CUSTOMER_LINE_CD
		     , MSP.ITEM_ID
		     , MID.ITEM_NAME
		     , MID.ITEM_GROUP_CODE     AS MODEL
		     , MSP.DEPARTURE_NUMBER
		     , TO_CHAR(MSP.DEPARTURE_DATE, 'YYYY-MM-DD') AS DEPARTURE_DATE
		     , MSP.DEPARTURE_QTY
		     , MSP.DEPARTURE_SPLIT_ID
		     , MSP.DESCRIPTION
		     , TO_CHAR(MSP.CANCEL_DATE, 'YYYY-MM-DD') AS CANCEL_DATE
		FROM   MOM_SHIPMENT_PLAN   MSP
		     , MOM_ITEM_DEFINITION MID
		WHERE  MSP.DIVISION_CD = MID.DIVISION_CD
		AND    MSP.COMPANY_CD  = MID.COMPANY_CD
		AND    MSP.ITEM_ID     = MID.ITEM_ID
		AND    MSP.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
	    AND    MSP.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		AND    TRUNC(MSP.CREATE_DATE) BETWEEN TO_DATE(#{fromDate, jdbcType=VARCHAR},'YYYY-MM-DD')  AND TO_DATE(#{toDate, jdbcType=VARCHAR},'YYYY-MM-DD')
		<if test = "shipmentGroupId != null and shipmentGroupId != ''">
		AND    UPPER(MSP.SHIPMENT_GROUP_ID) LIKE '%' || UPPER(#{shipmentGroupId, jdbcType=VARCHAR}) || '%'
		</if>
		<if test = "customerWoId != null and customerWoId != ''">
        AND    UPPER(MSP.CUSTOMER_WO_ID) LIKE '%' || UPPER(#{customerWoId, jdbcType=VARCHAR}) || '%'
        </if>
        <if test = "customerPoId != null and customerPoId != ''">
        AND    UPPER(MSP.CUSTOMER_PO_ID) LIKE '%' || UPPER(#{customerPoId, jdbcType=VARCHAR}) || '%'
        </if>
        <if test = "partNo != null and partNo != ''">
        AND    (UPPER(MSP.ITEM_ID) LIKE '%' || UPPER(#{partNo, jdbcType=VARCHAR}) || '%' 
        	 OR UPPER(MID.ITEM_NAME) LIKE '%' || UPPER(#{partNo, jdbcType=VARCHAR}) || '%' )
        </if>
        <if test = "cancelFlag != null and cancelFlag != ''">
	        <choose>
		        <when test = 'cancelFlag == "N"'>
		         AND    MSP.CANCEL_DATE IS NULL
		        </when>
		        <otherwise>
		        AND    MSP.CANCEL_DATE IS NOT NULL
		        </otherwise>
	        </choose>
        </if>
		ORDER BY MSP.SHIPMENT_GROUP_ID
		       , MSP.SHIPMENT_SEQ_NO
				
	</select>
	
	<insert id="create_shipPlanningCancel" statementType="CALLABLE">
		{
			CALL SP_MOM_SALES_ORDER_PKG.P_CANCEL_SHIPMENT_PLAN (
				 #{p_err_code, mode=OUT, jdbcType=VARCHAR}
				,#{p_err_msg, mode=OUT, jdbcType=VARCHAR}
				,#{divisionCd, mode=IN, jdbcType=VARCHAR}
				,#{companyCd, mode=IN, jdbcType=VARCHAR}
				,#{shipmentGroupId, mode=IN, jdbcType=VARCHAR}
				,#{userId, mode=IN, jdbcType=VARCHAR}
			)
		}
	</insert>

</mapper>