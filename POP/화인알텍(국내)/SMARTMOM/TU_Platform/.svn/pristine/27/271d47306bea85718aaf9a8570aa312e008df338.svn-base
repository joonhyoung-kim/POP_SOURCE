<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thirautech.mom.equipment.emRepairTimeStatus">
	<select id="get_emRepairTimeStatus_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT A.LOCATION_CD
		     , A.LOCATION_NAME
		     , A.EQUIPMENT_CD
		     , A.EQUIPMENT_NAME
		     , A.EQM_MTTF
		     , A.EQM_MTTR
		     , A.EQM_MTBF
		     , A.DESCRIPTION
		     , TO_CHAR(A.CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
		     , A.CREATE_BY
		     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME (A.DIVISION_CD 
		     										  , A.COMPANY_CD 
		     										  , A.CREATE_BY)
		          FROM DUAL) AS CREATE_BY_NAME
		     , TO_CHAR(A.UPDATE_DATE, 'YYYY-MM-DD') AS UPDATE_DATE
		     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME (A.DIVISION_CD 
		     										  , A.COMPANY_CD 
		     										  , A.UPDATE_BY)
		          FROM DUAL) AS UPDATE_BY_NAME
		  FROM (SELECT A.DIVISION_CD
	  				 , A.COMPANY_CD
		  			 , B.LOCATION_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME (B.DIVISION_CD
						                                      , B.COMPANY_CD
				                                              , 'EQM_LOCATION'
						                                      , B.LOCATION_CD)
						          FROM DUAL) AS LOCATION_NAME 
				     , A.EQUIPMENT_CD
				     , B.EQUIPMENT_NAME
				     , A.EQM_MTTF
				     , A.EQM_MTTR
				     , A.EQM_MTBF
				     , A.DESCRIPTION
				     , A.CREATE_DATE
				     , A.CREATE_BY
				     , A.UPDATE_DATE
				     , A.UPDATE_BY
				  FROM MOM_EQM_MEAN_TIME_MGT A
				     , MOM_EQUIPMENT B
				 WHERE A.DIVISION_CD = B.DIVISION_CD(+)
				   AND A.COMPANY_CD = B.COMPANY_CD(+)
				   AND A.EQUIPMENT_CD = B.EQUIPMENT_CD(+)
				   AND A.DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
				   AND A.COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
				   <if test="locationCd != null and locationCd != ''">
				   AND B.LOCATION_CD = #{locationCd, jdbcType=VARCHAR}
				   </if>
				   <if test="equipmentCd != null and equipmentCd != ''">
				   AND A.EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR}
				   </if>) A
				 ORDER BY A.LOCATION_NAME, A.CREATE_DATE DESC 
	</select>
	
	<select id="get_emRepairHist_list" resultType="camelMap" parameterType="java.util.HashMap">
		SELECT EQUIPMENT_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_EQUIPMENT_NAME(DIVISION_CD 
		                                                  , COMPANY_CD 
		                                                  , EQUIPMENT_CD)
		          FROM DUAL) AS EQUIPMENT_NAME
		     , TO_CHAR(START_TIME, 'YYYY-MM-DD HH24:MI:SS') AS START_TIME
		     , TO_CHAR(END_TIME, 'YYYY-MM-DD HH24:MI:SS') AS END_TIME
		     , DESCRIPTION
		     , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS CREATE_DATE
		     , CREATE_BY
		     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME (DIVISION_CD
				                                      , COMPANY_CD
				                                      , CREATE_BY)
				          FROM DUAL) AS CREATE_BY_NAME 
		  FROM MOM_EQM_WO_RESULT
		 WHERE DIVISION_CD = #{divisionCd, jdbcType=VARCHAR}
		   AND COMPANY_CD = #{companyCd, jdbcType=VARCHAR}
		   AND EQUIPMENT_CD = #{equipmentCd, jdbcType=VARCHAR}
		 ORDER BY START_TIME DESC
	</select>
	
</mapper>